<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="InterPrep Landing Page">
	<meta name="author" content="InterPrep Development Team">
	<link rel="shortcut icon" href="assets/ico/favicon.png">

	<title>ThoughtCloud</title>

	<!-- Bootstrap core CSS -->
	<link href="assets/css/bootstrap.css" rel="stylesheet">

	<!-- Custom styles for this template -->
	<link href="assets/css/main.css" rel="stylesheet">
	<link rel="stylesheet" href="assets/css/icomoon.css">
	<link href="assets/css/animate-custom.css" rel="stylesheet">

	<link href='http://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic' rel='stylesheet' type='text/css'>
	<link href='http://fonts.googleapis.com/css?family=Raleway:400,300,700' rel='stylesheet' type='text/css'>
	<script src="assets/js/test.js"></script>

	<!-- Parse setup -->
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script type="text/javascript" src="http://www.parsecdn.com/js/parse-1.3.0.min.js"></script>

	<script src="assets/js/jquery.min.js"></script>
	<script type="text/javascript" src="assets/js/modernizr.custom.js"></script>

	<script type="text/javascript">
	function parseInit() {
		Parse.initialize("k5ytQPE1ZXYSfBfxqKQCpGP124STSxdIXeopuTLp", "JOeN7E26XVxZ5vW8OIaANeyXEMU5lBLNF8s4BoLa");
	}

	function submitThought() {
	    var e = document.getElementById('results');
	         if(e.style.display == 'block')
	            e.style.display = 'none';
	         else
	            e.style.display = 'block';
	    document.getElementById('numThoughts').innerHTML="CHANGE ME";
		var thoughtValue = document.getElementById('thoughtBox').value;
		var aliasValue = document.getElementById('aliasBox').value;
		processIdolContent(thoughtValue, aliasValue);
	}

	function processIdolContent(thoughtValue, aliasValue) {
		topics = [];
		scores = [];
		console.log(thoughtValue);
		var request = makeHttpObject();
		request.open("GET","https://api.idolondemand.com/1/api/sync/analyzesentiment/v1?text="+thoughtValue+"&language=eng&apikey=d00696e1-ec9b-44e1-8265-591b852e5f0f",true);
		request.send(null);
		request.onreadystatechange = function() {
		  	if (request.readyState == 4) {
		  		result = request.responseText;
				result_obj = JSON.parse(result);
				for (var i = 0; i < result_obj.positive.length; i++) {
					topics.push(result_obj.positive[i].topic);
					scores.push(result_obj.positive[i].score);
				};
				for (var i = 0; i < result_obj.negative.length; i++) {
					topics.push(result_obj.negative[i].topic);
					scores.push(result_obj.negative[i].score);
				};
				pushToParse(thoughtValue, aliasValue, topics, scores);
		  	}
		};
	}

	function pushToParse(thoughtValue, aliasValue, topicsArr, scoresArr) {
		var ThoughtObject = Parse.Object.extend("ThoughtObject");
		console.log(topicsArr);
		console.log(scoresArr);
		
		// add constraints to query
		var query = new Parse.Query(ThoughtObject);
		for (var i = 0; i < topicsArr.length; i++) {
			query.equalTo("topics", topics[i]);
		}
		
		// find all thoughts that match
		query.find({
			success: function(results) {
				alert("Successfully retrieved " + results.length + " scores.");
				// Do something with the returned Parse.Object values
				for (var i = 0; i < results.length; i++) { 
					var object = results[i];
					alert(object.id + ' - ' + object.get('thought'));
				}
			},
			error: function(error) {
				alert("Error: " + error.code + " " + error.message);
			}
		});
		
		var thoughtObject = new ThoughtObject();
		thoughtObject.save({
			alias: aliasValue,
			thought: thoughtValue,
			topics: topicsArr,
			scores: scoresArr
		}, {
			success: function(thoughtObject) {
				// alert("SUCCESS");
			},
			error: function(thoughtObject, error) {
				alert("ERROR: " + error.code + " " + error.message);
			}
		});
	}

	function makeHttpObject() {
	  try {return new XMLHttpRequest();}
	  catch (error) {}
	  try {return new ActiveXObject("Msxml2.XMLHTTP");}
	  catch (error) {}
	  try {return new ActiveXObject("Microsoft.XMLHTTP");}
	  catch (error) {}

	  throw new Error("Could not create HTTP request object.");
	}

	</script>

  <!-- add toggle after http://stackoverflow.com/questions/19163327/how-do-i-make-a-div-hidden-by-default-using-javascript --> 
</head>

<body data-spy="scroll" data-offset="0" onload="parseInit()"> 

	<div id="headerwrap">
   <form onSubmit="JavaScript:submitThought()">
    <h1 id="question"> What are you thinking? </h1> 
    <br> 
      <div> 
       <input type="text" id="thoughtBox" name="thought_box" placeholder="&quot;I love HackMIT! &quot;" /><br>
       </div> 
       <br> 
      <div> 
         <input type="text" id="aliasBox" name="alias_box" placeholder="-HackMITHacker" /><br>
      </div> 
      <br> 
      <div> 
         <a href="#results" class="smoothScroll"> <input type="button" onclick="submitThought()" id="submitBtn" class="float-left submit-button" value="send to thoughtcloud" /></a>
      </div> 
    </form>
  </div>
  <!--should be invisible until a submission is made --> 
  <!--the number should be computed after button is pressed -->
  <div class="container" id="results" name="results"  style="display:none" align="center">
   <h1 class="quantity"><span id="numThoughts">7</span> THOUGHTS ARE WITH YOU</h1>
  </div> 

</body>
</html>
